generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  directUrl         = env("DIRECT_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  imageurl      String?
  firstName     String
  lastName      String
  phone         String?
  role          UserRole  @default(CLIENT)
  provider      Provider?
  bookings      Booking[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Provider {
  id            String    @id @default(uuid())
  firstName     String
  lastName      String
  imageurl      String?
  bio           String?
  email         String?
  user          User?      @relation(fields: [userId], references: [id])
  userId        String?    @unique
  bookings      Booking[]
  // for schedule
  // operatingHours OperatingHours[]
  bookingSettings BookingSettings?
  rating        Float?    @default(0)
  totalReviews  Int?      @default(0)
  role          ProviderRole @default(TRAINER)
  isAvailable   Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Service {
  id            String    @id @default(uuid())
  name          String
  description   String?
  bookings      Booking[]
  bookingSettings BookingSettings[] // Add reverse relation
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Booking {
  id            String    @id @default(uuid())
  client        User      @relation(fields: [clientId], references: [id])
  clientId      String
  provider      Provider  @relation(fields: [providerId], references: [id])
  providerId    String
  services      Service[]
  teamMembers   String[]  // Array of team member names
  price         Float
  sessionDuration Int     // in minutes
  startTime     DateTime
  endTime       DateTime
  status        BookingStatus @default(PENDING)
  specialRequests String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model OperatingHours {
  id            String    @id @default(uuid())
  // provider      Provider  @relation(fields: [providerId], references: [id])
  // providerId    String
  dayOfWeek     Int       // 0-6 (Sunday-Saturday)
  startTime     String    // Format: "HH:MM"
  endTime       String    // Format: "HH:MM"
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
// if provider
  // @@unique([providerId, dayOfWeek])
  @@unique([dayOfWeek])
}

model BookingSettings {
  id            String    @id @default(uuid())
  provider      Provider  @relation(fields: [providerId], references: [id])
  providerId    String    @unique
  service       Service   @relation(fields: [serviceId], references: [id])
  serviceId     String
  defaultSessionDuration Int @default(60)
  defaultPrice  Float     @default(650.00)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

enum ProviderRole {
  ADMIN
  TRAINER
  NUTRITIONIST
  PHYSIOTHERAPIST
  MASSAGE_THERAPIST
  MANAGER
  ASSISTANT
}

enum UserRole {
  CLIENT
  PROVIDER
  ADMIN
  SUPPORT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}